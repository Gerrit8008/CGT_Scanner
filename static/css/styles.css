import React, { useState, useEffect } from 'react';

const AdminDashboard = () => {
  const [stats, setStats] = useState({
    totalClients: 42,
    activeScans: 238,
    monthlyRevenue: 4250,
    deployedScanners: 35
  });
  
  const [recentClients, setRecentClients] = useState([
    { 
      name: 'Acme Corp', 
      scanner: 'Security Checker', 
      subscription: 'Pro', 
      status: 'Active' 
    },
    { 
      name: 'TechFlow Solutions', 
      scanner: 'TF Security Scanner', 
      subscription: 'Basic', 
      status: 'Active' 
    },
    { 
      name: 'Global Innovations', 
      scanner: 'Security First', 
      subscription: 'Enterprise', 
      status: 'Active' 
    },
    { 
      name: 'Stellar Services', 
      scanner: 'Stellar Secure', 
      subscription: 'Basic', 
      status: 'Pending' 
    },
    { 
      name: 'Quantum Data', 
      scanner: 'Quantum Security', 
      subscription: 'Pro', 
      status: 'Active' 
    }
  ]);
  
  const [recentActivity, setRecentActivity] = useState([
    {
      icon: 'bi-plus-circle',
      iconColor: 'text-success',
      content: 'New client <strong>Stellar Services</strong> registered',
      time: '2 hours ago'
    },
    {
      icon: 'bi-credit-card',
      iconColor: 'text-primary',
      content: '<strong>Acme Corp</strong> upgraded to Pro plan',
      time: '5 hours ago'
    },
    {
      icon: 'bi-search',
      iconColor: 'text-info',
      content: '50 new scans completed for <strong>Global Innovations</strong>',
      time: 'Yesterday'
    },
    {
      icon: 'bi-globe2',
      iconColor: 'text-warning',
      content: 'New scanner deployed for <strong>TechFlow Solutions</strong>',
      time: 'Yesterday'
    },
    {
      icon: 'bi-gear',
      iconColor: 'text-secondary',
      content: 'System maintenance completed',
      time: '2 days ago'
    }
  ]);

  const [deployedScanners, setDeployedScanners] = useState([
    {
      id: 1,
      client: {
        name: 'Acme Corporation',
        domain: 'acmecorp.com',
        initials: 'AC'
      },
      scannerName: 'Security Checker',
      subdomain: 'acme-corp.yourscannerdomain.com',
      status: 'Deployed',
      createdDate: 'May 1, 2025'
    },
    {
      id: 2,
      client: {
        name: 'Global Innovations',
        domain: 'globalinnovations.com',
        initials: 'GI'
      },
      scannerName: 'Security First',
      subdomain: 'global-innovations.yourscannerdomain.com',
      status: 'Deployed',
      createdDate: 'Apr 28, 2025'
    },
    {
      id: 3,
      client: {
        name: 'Stellar Services',
        domain: 'stellarservices.net',
        initials: 'SS'
      },
      scannerName: 'Stellar Secure',
      subdomain: 'stellar-services.yourscannerdomain.com',
      status: 'Pending',
      createdDate: 'May 2, 2025'
    }
  ]);

  const [userActivity, setUserActivity] = useState({
    loginsToday: 15,
    loginsWeek: 78,
    loginsMonth: 342,
    newUsersWeek: 5,
    newUsersMonth: 16
  });

  const [recentLogins, setRecentLogins] = useState([
    {
      username: 'admin',
      email: 'admin@scannerplatform.com',
      role: 'admin',
      ipAddress: '192.168.1.101',
      timestamp: 'Today, 10:25 AM'
    },
    {
      username: 'jsmith',
      email: 'john.smith@acmecorp.com',
      role: 'client',
      ipAddress: '203.0.113.42',
      timestamp: 'Today, 9:14 AM'
    },
    {
      username: 'mrogers',
      email: 'mike@globalinnovations.com',
      role: 'client',
      ipAddress: '198.51.100.73',
      timestamp: 'Yesterday, 4:37 PM'
    },
    {
      username: 'support',
      email: 'support@scannerplatform.com',
      role: 'admin',
      ipAddress: '192.168.1.105',
      timestamp: 'Yesterday, 2:18 PM'
    },
    {
      username: 'lchen',
      email: 'lucy@techflow.io',
      role: 'client',
      ipAddress: '172.16.24.98',
      timestamp: 'May 7, 2025, 11:05 AM'
    }
  ]);

  useEffect(() => {
    // Simulate fetching data - in a real app, these would be API calls
    // This is just to demonstrate the component's functionality
  }, []);

  return (
    <div className="container-fluid">
      <div className="row">
        {/* Sidebar */}
        <div className="col-md-3 col-lg-2 p-0 sidebar">
          <div className="text-center mb-4">
            <h4>Scanner Platform</h4>
            <p className="mb-0 small">Admin Panel</p>
          </div>
          
          <div className="px-3">
            <a href="#" className="sidebar-link active">
              <i className="bi bi-speedometer2"></i> Dashboard
            </a>
            <a href="#" className="sidebar-link">
              <i className="bi bi-people"></i> Client Management
            </a>
            <a href="#" className="sidebar-link">
              <i className="bi bi-plus-circle"></i> Create Scanner
            </a>
            <a href="#" className="sidebar-link">
              <i className="bi bi-credit-card"></i> Subscriptions
            </a>
            <a href="#" className="sidebar-link">
              <i className="bi bi-file-earmark-text"></i> Reports
            </a>
            <a href="#" className="sidebar-link">
              <i className="bi bi-gear"></i> Settings
            </a>
            
            <hr className="my-4" />
            
            <a href="#" className="sidebar-link text-danger">
              <i className="bi bi-box-arrow-right"></i> Logout
            </a>
          </div>
        </div>
        
        {/* Main Content */}
        <div className="col-md-9 col-lg-10 ms-auto main-content">
          <div className="d-flex justify-content-between align-items-center mb-4">
            <h2>Dashboard</h2>
            <div>
              <span className="badge bg-primary">Admin</span>
              <img src="/api/placeholder/36/36" className="rounded-circle ms-2" alt="Admin" />
            </div>
          </div>
          
          {/* Stats Overview */}
          <div className="row g-4 mb-4">
            <div className="col-md-3">
              <div className="card stat-card border-0 shadow-sm">
                <div className="card-body">
                  <div className="d-flex align-items-center mb-3">
                    <div className="icon-circle me-3 bg-primary bg-opacity-10">
                      <i className="bi bi-people text-primary"></i>
                    </div>
                    <h6 className="mb-0">Total Clients</h6>
                  </div>
                  <div className="stat-value">{stats.totalClients}</div>
                  <p className="text-success mb-0"><i className="bi bi-arrow-up"></i> 12% increase</p>
                </div>
              </div>
            </div>
            
            <div className="col-md-3">
              <div className="card stat-card border-0 shadow-sm">
                <div className="card-body">
                  <div className="d-flex align-items-center mb-3">
                    <div className="icon-circle me-3 bg-success bg-opacity-10">
                      <i className="bi bi-search text-success"></i>
                    </div>
                    <h6 className="mb-0">Active Scans</h6>
                  </div>
                  <div className="stat-value">{stats.activeScans}</div>
                  <p className="text-success mb-0"><i className="bi bi-arrow-up"></i> 8% increase</p>
                </div>
              </div>
            </div>
            
            <div className="col-md-3">
              <div className="card stat-card border-0 shadow-sm">
                <div className="card-body">
                  <div className="d-flex align-items-center mb-3">
                    <div className="icon-circle me-3 bg-warning bg-opacity-10">
                      <i className="bi bi-credit-card text-warning"></i>
                    </div>
                    <h6 className="mb-0">Monthly Revenue</h6>
                  </div>
                  <div className="stat-value">${stats.monthlyRevenue}</div>
                  <p className="text-success mb-0"><i className="bi bi-arrow-up"></i> 15% increase</p>
                </div>
              </div>
            </div>
            
            <div className="col-md-3">
              <div className="card stat-card border-0 shadow-sm">
                <div className="card-body">
                  <div className="d-flex align-items-center mb-3">
                    <div className="icon-circle me-3 bg-info bg-opacity-10">
                      <i className="bi bi-shield-check text-info"></i>
                    </div>
                    <h6 className="mb-0">Deployed Scanners</h6>
                  </div>
                  <div className="stat-value">{stats.deployedScanners}</div>
                  <p className="text-success mb-0"><i className="bi bi-arrow-up"></i> 5% increase</p>
                </div>
              </div>
            </div>
          </div>
          
          {/* User Activity Section */}
          <div className="row g-4 mb-4">
            <div className="col-md-8">
              <div className="card border-0 shadow-sm">
                <div className="card-header bg-white d-flex justify-content-between align-items-center">
                  <h5 className="mb-0">User Activity</h5>
                  <a href="#" className="btn btn-sm btn-outline-primary">Manage Users</a>
                </div>
                <div className="card-body">
                  <div className="chart-container" style={{ height: '250px' }}>
                    <UserActivityChart data={userActivity} />
                  </div>
                </div>
              </div>
            </div>
  
            <div className="col-md-4">
              <div className="card border-0 shadow-sm">
                <div className="card-header bg-white">
                  <h5 className="mb-0">User Distribution</h5>
                </div>
                <div className="card-body">
                  <div className="chart-container" style={{ height: '250px' }}>
                    <UserDistributionChart />
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Recent Logins */}
          <div className="row g-4 mb-4">
            <div className="col-12">
              <div className="card border-0 shadow-sm">
                <div className="card-header bg-white">
                  <h5 className="mb-0">Recent Logins</h5>
                </div>
                <div className="card-body p-0">
                  <div className="table-responsive">
                    <table className="table table-hover mb-0">
                      <thead>
                        <tr>
                          <th>User</th>
                          <th>Email</th>
                          <th>Role</th>
                          <th>IP Address</th>
                          <th>Time</th>
                        </tr>
                      </thead>
                      <tbody>
                        {recentLogins.map((login, index) => (
                          <tr key={index}>
                            <td>{login.username}</td>
                            <td>{login.email}</td>
                            <td>
                              <span className={`badge ${login.role === 'admin' ? 'bg-dark' : 'bg-info'}`}>
                                {login.role}
                              </span>
                            </td>
                            <td>{login.ipAddress}</td>
                            <td>{login.timestamp}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          {/* Client Scanners Section */}
          <div className="row g-4 mb-4">
            <div className="col-12">
              <div className="card border-0 shadow-sm">
                <div className="card-header bg-white d-flex justify-content-between align-items-center">
                  <h5 className="mb-0">Deployed Scanners</h5>
                  <a href="#" className="btn btn-sm btn-outline-primary">Create New Scanner</a>
                </div>
                <div className="card-body p-0">
                  <div className="table-responsive">
                    <table className="table table-hover mb-0">
                      <thead>
                        <tr>
                          <th>Client</th>
                          <th>Scanner Name</th>
                          <th>Subdomain</th>
                          <th>Status</th>
                          <th>Created Date</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {deployedScanners.map((scanner) => (
                          <tr key={scanner.id}>
                            <td>
                              <div className="d-flex align-items-center">
                                <div className="client-logo me-3">{scanner.client.initials}</div>
                                <div>
                                  <div className="fw-bold">{scanner.client.name}</div>
                                  <div className="text-muted small">{scanner.client.domain}</div>
                                </div>
                              </div>
                            </td>
                            <td>{scanner.scannerName}</td>
                            <td>
                              <a href={`https://${scanner.subdomain}`} target="_blank" rel="noreferrer">
                                {scanner.subdomain}
                              </a>
                            </td>
                            <td>
                              <span className={`badge ${scanner.status === 'Deployed' ? 'bg-success' : 'bg-warning text-dark'}`}>
                                {scanner.status}
                              </span>
                            </td>
                            <td>{scanner.createdDate}</td>
                            <td>
                              <div className="d-flex">
                                <button className="client-action" title="View Scanner">
                                  <i className="bi bi-eye"></i>
                                </button>
                                <button className="client-action" title="Edit Scanner">
                                  <i className="bi bi-pencil"></i>
                                </button>
                                <button className="client-action" title="Scanner Stats">
                                  <i className="bi bi-graph-up"></i>
                                </button>
                                <button className="client-action" title="More Options">
                                  <i className="bi bi-three-dots-vertical"></i>
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
                
          {/* Recent Clients & Activity */}
          <div className="row g-4 mb-4">
            <div className="col-md-7">
              <div className="card border-0 shadow-sm">
                <div className="card-header bg-white d-flex justify-content-between align-items-center">
                  <h5 className="mb-0">Recent Clients</h5>
                  <a href="#" className="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div className="card-body p-0">
                  <div className="table-responsive">
                    <table className="table table-hover mb-0">
                      <thead>
                        <tr>
                          <th>Company</th>
                          <th>Scanner</th>
                          <th>Subscription</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {recentClients.map((client, index) => (
                          <tr key={index}>
                            <td>{client.name}</td>
                            <td>{client.scanner}</td>
                            <td>
                              <span className={`subscription-badge subscription-${client.subscription.toLowerCase()}`}>
                                {client.subscription}
                              </span>
                            </td>
                            <td>
                              <span className={`badge ${client.status === 'Active' ? 'bg-success' : 'bg-warning text-dark'}`}>
                                {client.status}
                              </span>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="col-md-5">
              <div className="card border-0 shadow-sm">
                <div className="card-header bg-white">
                  <h5 className="mb-0">Recent Activity</h5>
                </div>
                <div className="card-body p-0">
                  {recentActivity.map((activity, index) => (
                    <div className="activity-item" key={index}>
                      <div className="activity-icon">
                        <i className={`bi ${activity.icon} ${activity.iconColor}`}></i>
                      </div>
                      <div className="activity-content">
                        <div dangerouslySetInnerHTML={{ __html: activity.content }}></div>
                        <div className="activity-time">{activity.time}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// User Activity Chart Component
const UserActivityChart = ({ data }) => {
  // In a real implementation, this would use a charting library like Chart.js
  // Here we're creating a simplified visual representation
  return (
    <div className="d-flex h-100 align-items-end">
      <div className="d-flex flex-column align-items-center mx-2" style={{ width: '25%' }}>
        <div className="bg-primary rounded-top" style={{ width: '100%', height: `${data.loginsToday * 2}px` }}></div>
        <div className="mt-2">Today</div>
      </div>
      <div className="d-flex flex-column align-items-center mx-2" style={{ width: '25%' }}>
        <div className="bg-primary rounded-top" style={{ width: '100%', height: `${data.loginsWeek}px` }}></div>
        <div className="mt-2">This Week</div>
      </div>
      <div className="d-flex flex-column align-items-center mx-2" style={{ width: '25%' }}>
        <div className="bg-primary rounded-top" style={{ width: '100%', height: `${Math.min(data.loginsMonth / 2, 200)}px` }}></div>
        <div className="mt-2">This Month</div>
      </div>
      <div className="d-flex flex-column align-items-center mx-2" style={{ width: '25%' }}>
        <div className="bg-info rounded-top" style={{ width: '100%', height: `${data.newUsersMonth * 5}px` }}></div>
        <div className="mt-2">New Users</div>
      </div>
    </div>
  );
};

// User Distribution Chart Component
const UserDistributionChart = () => {
  // This would typically use a charting library in a real implementation
  // Here we're creating a simplified doughnut chart visualization
  const data = [
    { label: 'Admin', value: 5, color: 'rgba(52, 152, 219, 0.8)' },
    { label: 'Client', value: 37, color: 'rgba(255, 105, 0, 0.8)' }
  ];
  
  const total = data.reduce((sum, item) => sum + item.value, 0);
  
  return (
    <div className="h-100 d-flex flex-column align-items-center justify-content-center">
      <div style={{ position: 'relative', width: '150px', height: '150px' }}>
        {data.map((item, index) => {
          const startAngle = index === 0 ? 0 : data.slice(0, index).reduce((sum, d) => sum + d.value, 0) / total * 360;
          const angle = item.value / total * 360;
          
          return (
            <div key={index} style={{
              position: 'absolute',
              width: '100%',
              height: '100%',
              borderRadius: '50%',
              background: `conic-gradient(${item.color} ${startAngle}deg, ${item.color} ${startAngle + angle}deg, transparent ${startAngle + angle}deg)`,
            }} />
          );
        })}
        <div style={{
          position: 'absolute',
          width: '70%',
          height: '70%',
          top: '15%',
          left: '15%',
          borderRadius: '50%',
          background: 'white',
        }} />
      </div>
      <div className="d-flex justify-content-center mt-3">
        {data.map((item, index) => (
          <div key={index} className="d-flex align-items-center mx-2">
            <div style={{ width: '12px', height: '12px', background: item.color, borderRadius: '2px', marginRight: '5px' }} />
            <span>{item.label} ({item.value})</span>
          </div>
        ))}
      </div>
    </div>
  );
};

export default AdminDashboard;
