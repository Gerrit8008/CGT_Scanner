import React, { useState } from 'react';

const ScannerEditForm = () => {
  const [scanner, setScanner] = useState({
    id: 1,
    scanner_name: 'Security Scanner Pro',
    business_domain: 'example.com',
    contact_email: 'contact@example.com',
    contact_phone: '555-123-4567',
    primary_color: '#FF6900',
    secondary_color: '#808588',
    logo_path: null,
    favicon_path: null,
    email_subject: 'Your Security Scan Report',
    email_intro: 'Thank you for using our security scanner. Please find your detailed report attached.',
    default_scans: ['network', 'web', 'email', 'system']
  });
  
  const [logoPreview, setLogoPreview] = useState(null);
  const [faviconPreview, setFaviconPreview] = useState(null);
  const [isSaving, setIsSaving] = useState(false);
  
  // Handle input changes
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setScanner({
      ...scanner,
      [name]: value
    });
  };
  
  // Handle color changes and sync with hex input
  const handleColorChange = (e) => {
    const { name, value } = e.target;
    setScanner({
      ...scanner,
      [name]: value
    });
    
    // Update the hex input by ID
    if (name === 'primary_color') {
      document.getElementById('primaryColorHex').value = value;
    } else if (name === 'secondary_color') {
      document.getElementById('secondaryColorHex').value = value;
    }
  };
  
  // Handle hex input changes
  const handleHexChange = (e) => {
    const { id, value } = e.target;
    const colorName = id === 'primaryColorHex' ? 'primary_color' : 'secondary_color';
    
    setScanner({
      ...scanner,
      [colorName]: value
    });
  };
  
  // Handle file uploads
  const handleFileChange = (e) => {
    const { name, files } = e.target;
    
    if (files && files[0]) {
      const reader = new FileReader();
      
      reader.onload = (e) => {
        if (name === 'logo') {
          setLogoPreview(e.target.result);
        } else if (name === 'favicon') {
          setFaviconPreview(e.target.result);
        }
      };
      
      reader.readAsDataURL(files[0]);
    }
  };
  
  // Handle checkbox changes for scan options
  const handleScanOptionChange = (e) => {
    const { value, checked } = e.target;
    
    if (checked) {
      setScanner({
        ...scanner,
        default_scans: [...scanner.default_scans, value]
      });
    } else {
      setScanner({
        ...scanner,
        default_scans: scanner.default_scans.filter(option => option !== value)
      });
    }
  };
  
  // Handle form submission
  const handleSubmit = (e) => {
    if (e) e.preventDefault();
    setIsSaving(true);
    
    // Simulate API call to save changes
    setTimeout(() => {
      setIsSaving(false);
      // In a real app, you would redirect or show a success message
      alert('Scanner updated successfully!');
    }, 1500);
  };
  
  return (
    <div className="container-fluid">
      <div className="row">
        {/* Sidebar */}
        <div className="col-md-3 col-lg-2 p-0 sidebar">
          <div className="text-center mb-4">
            <h4>Scanner Platform</h4>
            <p className="mb-0 small">Client Portal</p>
          </div>
          
          <div className="px-3">
            <a href="#" className="sidebar-link">
              <i className="bi bi-speedometer2"></i> Dashboard
            </a>
            <a href="#" className="sidebar-link active">
              <i className="bi bi-shield-check"></i> My Scanners
            </a>
            <a href="#" className="sidebar-link">
              <i className="bi bi-file-earmark-text"></i> Scan Reports
            </a>
            <a href="#" className="sidebar-link">
              <i className="bi bi-gear"></i> Settings
            </a>
            
            <hr className="my-4" />
            
            <a href="#" className="sidebar-link text-danger">
              <i className="bi bi-box-arrow-right"></i> Logout
            </a>
          </div>
        </div>
        
        {/* Main Content */}
        <div className="col-md-9 col-lg-10 ms-auto main-content">
          <div className="d-flex justify-content-between align-items-center mb-4">
            <div>
              <h2>Edit Scanner</h2>
              <nav aria-label="breadcrumb">
                <ol className="breadcrumb mb-0">
                  <li className="breadcrumb-item"><a href="#">Dashboard</a></li>
                  <li className="breadcrumb-item"><a href="#">Scanners</a></li>
                  <li className="breadcrumb-item"><a href="#">{scanner.scanner_name}</a></li>
                  <li className="breadcrumb-item active" aria-current="page">Edit</li>
                </ol>
              </nav>
            </div>
            <div>
              <a href="#" className="btn btn-outline-secondary">
                <i className="bi bi-arrow-left me-2"></i>Back to Scanner
              </a>
            </div>
          </div>
          
          <div>
            {/* Basic Information Card */}
            <div className="card edit-card mb-4">
              <div className="card-header">
                <h4 className="mb-0"><i className="bi bi-info-circle me-2"></i>Basic Information</h4>
              </div>
              <div className="card-body">
                <div className="row mb-3">
                  <div className="col-md-6">
                    <label htmlFor="scannerName" className="form-label required">Scanner Name</label>
                    <input
                      type="text"
                      className="form-control"
                      id="scannerName"
                      name="scanner_name"
                      value={scanner.scanner_name}
                      onChange={handleInputChange}
                      required
                    />
                    <div className="form-text">This name will appear in the scanner interface and reports.</div>
                  </div>
                  
                  <div className="col-md-6">
                    <label htmlFor="businessDomain" className="form-label required">Business Domain</label>
                    <div className="input-group">
                      <span className="input-group-text">https://</span>
                      <input
                        type="text"
                        className="form-control"
                        id="businessDomain"
                        name="business_domain"
                        value={scanner.business_domain}
                        onChange={handleInputChange}
                        required
                      />
                    </div>
                    <div className="form-text">The primary domain that will be scanned by default.</div>
                  </div>
                </div>
                
                <div className="row mb-3">
                  <div className="col-md-6">
                    <label htmlFor="contactEmail" className="form-label required">Contact Email</label>
                    <input
                      type="email"
                      className="form-control"
                      id="contactEmail"
                      name="contact_email"
                      value={scanner.contact_email}
                      onChange={handleInputChange}
                      required
                    />
                    <div className="form-text">Email used for scanner notifications and reports.</div>
                  </div>
                  
                  <div className="col-md-6">
                    <label htmlFor="contactPhone" className="form-label">Contact Phone</label>
                    <input
                      type="tel"
                      className="form-control"
                      id="contactPhone"
                      name="contact_phone"
                      value={scanner.contact_phone}
                      onChange={handleInputChange}
                    />
                    <div className="form-text">Optional phone number for account notifications.</div>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Branding Card */}
            <div className="card edit-card mb-4">
              <div className="card-header">
                <h4 className="mb-0"><i className="bi bi-palette me-2"></i>Branding</h4>
              </div>
              <div className="card-body">
                <div className="row mb-4">
                  <div className="col-md-6 mb-3">
                    <label htmlFor="primaryColor" className="form-label">Primary Color</label>
                    <div className="input-group">
                      <input
                        type="color"
                        className="form-control form-control-color"
                        id="primaryColor"
                        name="primary_color"
                        value={scanner.primary_color}
                        onChange={handleColorChange}
                      />
                      <input
                        type="text"
                        className="form-control"
                        id="primaryColorHex"
                        value={scanner.primary_color}
                        onChange={handleHexChange}
                      />
                    </div>
                    <div className="form-text">This color will be used for buttons, headers, and other primary elements.</div>
                  </div>
                  
                  <div className="col-md-6 mb-3">
                    <label htmlFor="secondaryColor" className="form-label">Secondary Color</label>
                    <div className="input-group">
                      <input
                        type="color"
                        className="form-control form-control-color"
                        id="secondaryColor"
                        name="secondary_color"
                        value={scanner.secondary_color}
                        onChange={handleColorChange}
                      />
                      <input
                        type="text"
                        className="form-control"
                        id="secondaryColorHex"
                        value={scanner.secondary_color}
                        onChange={handleHexChange}
                      />
                    </div>
                    <div className="form-text">This color will be used for secondary elements and accents.</div>
                  </div>
                </div>
                
                <div className="row mb-4">
                  <div className="col-md-6 mb-3">
                    <label htmlFor="logoUpload" className="form-label">Company Logo</label>
                    <input
                      type="file"
                      className="form-control"
                      id="logoUpload"
                      name="logo"
                      accept="image/*"
                      onChange={handleFileChange}
                    />
                    <div className="form-text">Recommended size: 200px × 50px. PNG or SVG with transparent background preferred.</div>
                    
                    {scanner.logo_path && (
                      <div className="mt-2">
                        <label>Current Logo:</label>
                        <div>
                          <img src={scanner.logo_path} alt="Current Logo" className="file-preview" />
                        </div>
                      </div>
                    )}
                    
                    {logoPreview && (
                      <div id="logoPreviewContainer" className="mt-2">
                        <label>New Logo Preview:</label>
                        <div>
                          <img id="logoPreview" src={logoPreview} alt="Logo Preview" className="file-preview" />
                        </div>
                      </div>
                    )}
                  </div>
                  
                  <div className="col-md-6 mb-3">
                    <label htmlFor="faviconUpload" className="form-label">Favicon</label>
                    <input
                      type="file"
                      className="form-control"
                      id="faviconUpload"
                      name="favicon"
                      accept="image/*"
                      onChange={handleFileChange}
                    />
                    <div className="form-text">Recommended size: 32px × 32px. ICO, PNG, or SVG format.</div>
                    
                    {scanner.favicon_path && (
                      <div className="mt-2">
                        <label>Current Favicon:</label>
                        <div>
                          <img src={scanner.favicon_path} alt="Current Favicon" className="file-preview" style={{ maxHeight: '32px' }} />
                        </div>
                      </div>
                    )}
                    
                    {faviconPreview && (
                      <div id="faviconPreviewContainer" className="mt-2">
                        <label>New Favicon Preview:</label>
                        <div>
                          <img id="faviconPreview" src={faviconPreview} alt="Favicon Preview" className="file-preview" style={{ maxHeight: '32px' }} />
                        </div>
                      </div>
                    )}
                  </div>
                </div>
                
                <div className="row">
                  <div className="col-md-12">
                    <h5>Live Preview</h5>
                    <div className="preview-container">
                      <div 
                        className="preview-header" 
                        id="previewHeader" 
                        style={{ backgroundColor: scanner.secondary_color }}
                      >
                        <img 
                          src={logoPreview || scanner.logo_path || "/static/images/logo.png"} 
                          alt="Logo Preview" 
                          className="preview-logo" 
                          id="previewLogo" 
                          onError={(e) => {
                            e.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjUwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjx0ZXh0IHg9IjEwIiB5PSIzMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE4IiBmaWxsPSJ3aGl0ZSI+Q2xpZW50IExvZ288L3RleHQ+PC9zdmc+';
                            e.target.style.maxWidth = '150px';
                          }}
                        />
                      </div>
                      <div className="text-center my-4">
                        <div 
                          className="preview-button" 
                          id="previewButton" 
                          style={{ backgroundColor: scanner.primary_color }}
                        >
                          Start Security Scan
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Email Settings Card */}
            <div className="card edit-card mb-4">
              <div className="card-header">
                <h4 className="mb-0"><i className="bi bi-envelope me-2"></i>Email Settings</h4>
              </div>
              <div className="card-body">
                <div className="mb-3">
                  <label htmlFor="emailSubject" className="form-label">Email Subject</label>
                  <input
                    type="text"
                    className="form-control"
                    id="emailSubject"
                    name="email_subject"
                    value={scanner.email_subject}
                    onChange={handleInputChange}
                  />
                  <div className="form-text">The subject line for emails sent with scan reports.</div>
                </div>
                
                <div className="mb-3">
                  <label htmlFor="emailIntro" className="form-label">Email Introduction</label>
                  <textarea
                    className="form-control"
                    id="emailIntro"
                    name="email_intro"
                    rows="3"
                    value={scanner.email_intro}
                    onChange={handleInputChange}
                  ></textarea>
                  <div className="form-text">This text will appear at the beginning of report emails.</div>
                </div>
              </div>
            </div>
            
            {/* Scan Options Card */}
            <div className="card edit-card mb-4">
              <div className="card-header">
                <h4 className="mb-0"><i className="bi bi-gear me-2"></i>Scan Options</h4>
              </div>
              <div className="card-body">
                <p>Select which security scans should be enabled by default:</p>
                
                <div className="row">
                  <div className="col-md-6 mb-3">
                    <div className="form-check form-switch">
                      <input
                        className="form-check-input"
                        type="checkbox"
                        id="networkScan"
                        name="default_scans"
                        value="network"
                        checked={scanner.default_scans.includes('network')}
                        onChange={handleScanOptionChange}
                      />
                      <label className="form-check-label" htmlFor="networkScan">
                        <strong>Network Vulnerabilities</strong>
                      </label>
                    </div>
                    <p className="text-muted small ms-4">Open ports, misconfigured services, outdated protocols</p>
                  </div>
                  
                  <div className="col-md-6 mb-3">
                    <div className="form-check form-switch">
                      <input
                        className="form-check-input"
                        type="checkbox"
                        id="webScan"
                        name="default_scans"
                        value="web"
                        checked={scanner.default_scans.includes('web')}
                        onChange={handleScanOptionChange}
                      />
                      <label className="form-check-label" htmlFor="webScan">
                        <strong>Web Application Vulnerabilities</strong>
                      </label>
                    </div>
                    <p className="text-muted small ms-4">XSS, SQL injection, CSRF, insecure configurations</p>
                  </div>
                </div>
                
                <div className="row">
                  <div className="col-md-6 mb-3">
                    <div className="form-check form-switch">
                      <input
                        className="form-check-input"
                        type="checkbox"
                        id="emailScan"
                        name="default_scans"
                        value="email"
                        checked={scanner.default_scans.includes('email')}
                        onChange={handleScanOptionChange}
                      />
                      <label className="form-check-label" htmlFor="emailScan">
                        <strong>Email Security</strong>
                      </label>
                    </div>
                    <p className="text-muted small ms-4">SPF, DKIM, DMARC, email spoofing protection</p>
                  </div>
                  
                  <div className="col-md-6 mb-3">
                    <div className="form-check form-switch">
                      <input
                        className="form-check-input"
                        type="checkbox"
                        id="systemScan"
                        name="default_scans"
                        value="system"
                        checked={scanner.default_scans.includes('system')}
                        onChange={handleScanOptionChange}
                      />
                      <label className="form-check-label" htmlFor="systemScan">
                        <strong>System Security</strong>
                      </label>
                    </div>
                    <p className="text-muted small ms-4">OS updates, firewall configuration, system protections</p>
                  </div>
                </div>
                
                <div className="mb-3 mt-3">
                  <div className="form-check form-switch">
                    <input
                      className="form-check-input"
                      type="checkbox"
                      id="sslScan"
                      name="default_scans"
                      value="ssl"
                      checked={scanner.default_scans.includes('ssl')}
                      onChange={handleScanOptionChange}
                    />
                    <label className="form-check-label" htmlFor="sslScan">
                      <strong>SSL/TLS Configuration</strong>
                    </label>
                  </div>
                  <p className="text-muted small ms-4">Certificate verification, protocol vulnerabilities, cipher suite analysis</p>
                </div>
              </div>
            </div>
            
            {/* Form Buttons */}
            <div className="d-flex justify-content-between mb-4">
              <a href="#" className="btn btn-outline-secondary">
                <i className="bi bi-x-circle me-2"></i>Cancel
              </a>
              <div>
                <button 
                  type="button" 
                  className="btn btn-primary" 
                  id="saveChangesBtn"
                  disabled={isSaving}
                  onClick={handleSubmit}
                >
                  {isSaving ? (
                    <>
                      <span className="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...
                    </>
                  ) : (
                    <>
                      <i className="bi bi-save me-2"></i>Save Changes
                    </>
                  )}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
